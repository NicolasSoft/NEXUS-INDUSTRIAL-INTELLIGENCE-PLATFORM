// Adicione no inÃ­cio do app.jsimport { simulateThreatDetection } from './cybersecurity.js';// Elementos DOM adicionaisconst healthScoreEl = document.getElementById("healthScore");const systemStatusEl = document.getElementById("systemStatus"); // Renomeadoconst themeToggle = document.getElementById("themeToggle");// ===== NOVAS FUNCIONALIDADES =====// 1. Tema Dark/Lightfunction initThemeToggle() {  const savedTheme = localStorage.getItem('theme') || 'light';  document.body.classList.toggle('dark-theme', savedTheme === 'dark');    themeToggle.addEventListener('click', () => {    document.body.classList.toggle('dark-theme');    const isDark = document.body.classList.contains('dark-theme');    localStorage.setItem('theme', isDark ? 'dark' : 'light');    themeToggle.querySelector('.theme-icon').textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';  });}// 2. SimulaÃ§Ã£o de AmeaÃ§as CibernÃ©ticasfunction startThreatSimulation() {  setInterval(() => {    const threatLevels = ['LOW', 'MEDIUM', 'HIGH'];    const randomThreat = Math.random() > 0.9 ? 'HIGH' :                         Math.random() > 0.7 ? 'MEDIUM' : 'LOW';        const threatEl = document.querySelector('.metric-value');    threatEl.textContent = randomThreat;    threatEl.className = `metric-value ${randomThreat.toLowerCase()}`;        if (randomThreat === 'HIGH') {      addSecurityAlert('ðŸš¨ High threat detected: Port scanning detected');    }  }, 10000);}// 3. AnÃ¡lise Preditiva Melhoradafunction updatePredictiveMaintenance(healthScore) {  const progressBar = document.querySelector('.progress-bar');  const nextMaintenance = document.querySelector('.prediction-text strong');    // Calcular tempo atÃ© manutenÃ§Ã£o baseado no health score  const hoursUntilMaintenance = Math.floor((healthScore / 100) * 72);  const progressPercentage = 100 - healthScore;    progressBar.style.width = `${progressPercentage}%`;  nextMaintenance.textContent = `${hoursUntilMaintenance}h`;    // Mudar cor da barra baseado na urgÃªncia  if (hoursUntilMaintenance < 24) {    progressBar.style.background = '#f44336';  } else if (hoursUntilMaintenance < 48) {    progressBar.style.background = '#ff9800';  } else {    progressBar.style.background = '#4caf50';  }}// 4. VisualizaÃ§Ã£o de Rede IoTfunction renderNetworkTopology() {  const networkCanvas = document.createElement('canvas');  networkCanvas.id = 'networkCanvas';  networkCanvas.width = 400;  networkCanvas.height = 200;    const container = document.querySelector('.security-dashboard');  container.insertAdjacentHTML('beforeend', '<h3>IoT Network Topology</h3>');  container.appendChild(networkCanvas);    // Implementar visualizaÃ§Ã£o de nÃ³s da rede  drawNetworkTopology(networkCanvas);}function drawNetworkTopology(canvas) {  const ctx = canvas.getContext('2d');  ctx.fillStyle = '#4caf50';  ctx.beginPath();  ctx.arc(200, 100, 30, 0, Math.PI * 2);  ctx.fill();  ctx.fillText('Hub Central', 170, 105);    // Desenhar nÃ³s perifÃ©ricos  const nodes = [[80, 50], [320, 50], [80, 150], [320, 150]];  nodes.forEach(([x, y]) => {    ctx.fillStyle = '#2196F3';    ctx.beginPath();    ctx.arc(x, y, 15, 0, Math.PI * 2);    ctx.fill();        // Conectar ao hub    ctx.strokeStyle = '#ccc';    ctx.beginPath();    ctx.moveTo(200, 100);    ctx.lineTo(x, y);    ctx.stroke();  });}// 5. Dashboard de Performance da IAfunction updateAIPerformance() {  const accuracyEl = document.querySelector('.metric-value');  // Simular variaÃ§Ã£o na precisÃ£o da IA  const baseAccuracy = 92.4;  const variation = (Math.random() - 0.5) * 0.4; // Â±0.2%  const currentAccuracy = baseAccuracy + variation;    accuracyEl.textContent = `${currentAccuracy.toFixed(1)}%`;}// 6. Sistema de Alertas Inteligentefunction addSecurityAlert(message) {  const alertList = document.getElementById('alertList');  const li = document.createElement('li');  li.innerHTML = `    <span class="alert-time">${new Date().toLocaleTimeString()}</span>    <span class="alert-message">${message}</span>    <button class="alert-dismiss">Ã—</button>  `;    li.querySelector('.alert-dismiss').addEventListener('click', function() {    li.style.opacity = '0';    setTimeout(() => li.remove(), 300);  });    // Efeito de destaque para alertas importantes  if (message.includes('HIGH') || message.includes('CRITICAL')) {    li.style.background = 'linear-gradient(90deg, rgba(226,0,21,0.1) 0%, transparent 100%)';    li.style.animation = 'pulse 0.5s ease';  }    alertList.prepend(li);}// ===== ATUALIZAÃ‡ÃƒO DO WEBSOCKET =====new FakeWebSocket((message) => {  if (message.type !== "telemetry") return;    const data = message.payload;  const isAnomaly = detectAnomaly(data);  const healthScore = calculateHealthScore(data);    // Atualizar elementos existentes  tempEl.innerText = `${data.temperature} Â°C`;  vibEl.innerText = data.vibration;  rpmEl.innerText = data.rpm;    // Atualizar elementos novos  healthScoreEl.innerText = `${healthScore}%`;  updatePredictiveMaintenance(healthScore);  updateAIPerformance();    // Sistema de alertas aprimorado  if (isAnomaly) {    const alertMsg = `[${new Date(data.timestamp).toLocaleTimeString()}] Anomaly detected: Temp=${data.temperature}Â°C, Vib=${data.vibration}`;    addSecurityAlert(alertMsg);  }    // Atualizar grÃ¡ficos  pushHistory(tempHistory, Number(data.temperature));  pushHistory(vibrationHistory, Number(data.vibration));  updateTempChart(tempChart, data.temperature);  drawVibrationChart(vibrationCanvas, vibrationHistory);  updateSystemStatusUI(isAnomaly, healthScore);});// ===== INICIALIZAÃ‡ÃƒO =====document.addEventListener('DOMContentLoaded', () => {  initThemeToggle();  startThreatSimulation();  renderNetworkTopology();    // Inicializar mÃ©tricas  setInterval(updateAIPerformance, 15000);    // VerificaÃ§Ã£o de seguranÃ§a contÃ­nua  setInterval(() => {    const lastScan = document.querySelector('.security-time');    const minutes = Math.floor(Math.random() * 30);    lastScan.textContent = `${minutes} min ago`;  }, 60000);});import { FakeWebSocket } from "./websocket.js";import { detectAnomaly, calculateHealthScore } from "./sensors.js";import { createTempChart, updateTempChart } from "./charts.js";import { drawVibrationChart } from "./canvasChart.js";// --- ConfiguraÃ§Ã£o e Estado ---const HISTORY_SIZE = 50;const tempHistory = [];const vibrationHistory = [];// --- Elementos do DOM ---const tempEl = document.getElementById("temp");const vibEl = document.getElementById("vibration");const rpmEl = document.getElementById("rpm");const statusEl = document.getElementById("status");const alertList = document.getElementById("alertList");const healthScoreEl = document.getElementById("systemStatus"); // Reutilizando elemento para Health Scoreconst vibrationCanvas = document.getElementById("vibrationCanvas");// --- InicializaÃ§Ã£o de GrÃ¡ficos ---const tempChart = createTempChart(  document.getElementById("tempChart").getContext("2d"));// --- LÃ³gica Auxiliar ---function pushHistory(arr, value) {  if (arr.length >= HISTORY_SIZE) arr.shift();  arr.push(value);}function updateSystemStatusUI(isAnomaly, healthScore) {  const dot = systemStatusEl.querySelector(".dot");  // Usar novo nome  const text = systemStatusEl.querySelector(".text");  // LÃ³gica estilo Bosch: Monitoramento Preditivo  if (isAnomaly || healthScore < 60) {    dot.className = "dot critical";    text.innerText = `CRITICAL (Health: ${healthScore}%)`;    statusEl.innerText = "ðŸ”´ Anomalia Detectada (IA)";    statusEl.style.color = "#ff6b6b";  } else if (healthScore < 85) {    dot.className = "dot warning"; // Assumindo que existe CSS para warning    text.innerText = `WARNING (Health: ${healthScore}%)`;    statusEl.innerText = "ðŸŸ¡ AtenÃ§Ã£o Requerida";    statusEl.style.color = "#ff9f43";  } else {    dot.className = "dot normal";    text.innerText = `SYSTEM NORMAL (Health: ${healthScore}%)`;    statusEl.innerText = "ðŸŸ¢ OperaÃ§Ã£o Nominal";    statusEl.style.color = "#4caf50";  }}// --- WebSocket (Single Source of Truth) ---// Simulando conexÃ£o segura com token (Cybersecurity)const AUTH_TOKEN = "BOSCH_IOT_SECURE_TOKEN_2025_X9";new FakeWebSocket((message) => {  if (message.type !== "telemetry") return;    const data = message.payload;  const isAnomaly = detectAnomaly(data);  const healthScore = calculateHealthScore(data);  // 1. Atualizar Dados NumÃ©ricos  tempEl.innerText = `${data.temperature} Â°C`;  vibEl.innerText = data.vibration;  rpmEl.innerText = data.rpm;  // 2. Atualizar HistÃ³rico e GrÃ¡ficos  pushHistory(tempHistory, Number(data.temperature));  pushHistory(vibrationHistory, Number(data.vibration));  updateTempChart(tempChart, data.temperature);  drawVibrationChart(vibrationCanvas, vibrationHistory);  // 3. Atualizar Status e Alertas  updateSystemStatusUI(isAnomaly, healthScore);  if (isAnomaly) {    const li = document.createElement("li");    li.innerText = `[${new Date(data.timestamp).toLocaleTimeString()}] Falha detectada - VibraÃ§Ã£o: ${data.vibration}`;        // Limitar lista de alertas para nÃ£o travar o DOM    if (alertList.children.length > 10) alertList.lastElementChild.remove();    alertList.prepend(li);  }}, AUTH_TOKEN);import "./auth.js";const token = localStorage.getItem("token");if (!token) {  window.location.href = "login.html";}const payload = JSON.parse(atob(token));if (payload.role !== "admin") {  document.querySelector(".alerts").style.display = "none";}import { RealWebSocket } from "./websocket.js";new RealWebSocket((message) => {  // tudo continua funcionando});